import { Component, ContentChild, Input, Output, EventEmitter, Optional, Host } from '@angular/core';
import { first } from 'rxjs/operators';
import { BaseToolbarDirective } from './grid-toolbar.base';
import { IgxGridToolbarComponent } from './grid-toolbar.component';
import { IgxExcelTextDirective, IgxCSVTextDirective } from './common';
import { CsvFileTypes, IgxCsvExporterOptions, IgxCsvExporterService, IgxExcelExporterOptions, IgxExcelExporterService } from '../../services/public_api';
/**
 * Provides a pre-configured exporter component for the grid.
 *
 * @remarks
 * This component still needs the actual exporter service(s) provided in the DI chain
 * in order to export something.
 *
 * @igxModule IgxGridToolbarModule
 * @igxParent IgxGridToolbarComponent
 *
 */
export class IgxGridToolbarExporterComponent extends BaseToolbarDirective {
    constructor(toolbar, excelExporter, csvExporter) {
        super(toolbar);
        this.toolbar = toolbar;
        this.excelExporter = excelExporter;
        this.csvExporter = csvExporter;
        /**
         * Show entry for CSV export.
         */
        this.exportCSV = true;
        /**
         * Show entry for Excel export.
         */
        this.exportExcel = true;
        /**
         * The name for the exported file.
         */
        this.filename = 'ExportedData';
        /**
         * Indicates whether there is an export in progress.
         */
        this.isExporting = false;
        /**
         * Emitted when starting an export operation. Re-emitted additionally
         * by the grid itself.
         */
        this.exportStarted = new EventEmitter();
        /**
         * Emitted on successful ending of an export operation.
         */
        this.exportEnded = new EventEmitter();
    }
    /**
     * Returns whether the CSV exporter service is available in the DI chain.
     */
    get hasCsvExporter() {
        return !!this.csvExporter;
    }
    /**
     * Returns whether the Excel exporter service is available in the DI chain.
     */
    get hasExcelExporter() {
        return !!this.excelExporter;
    }
    export(type, toggleRef) {
        let options;
        let exporter;
        toggleRef === null || toggleRef === void 0 ? void 0 : toggleRef.close();
        switch (type) {
            case 'csv':
                options = new IgxCsvExporterOptions(this.filename, CsvFileTypes.CSV);
                exporter = this.csvExporter;
                break;
            case 'excel':
                options = new IgxExcelExporterOptions(this.filename);
                exporter = this.excelExporter;
        }
        const args = { exporter, options, grid: this.grid, cancel: false };
        this.exportStarted.emit(args);
        this.grid.onToolbarExporting.emit(args);
        this.isExporting = true;
        this.toolbar.showProgress = true;
        if (args.cancel) {
            return;
        }
        exporter.onExportEnded.pipe(first()).subscribe(() => {
            this.exportEnded.emit();
            this.isExporting = false;
            this.toolbar.showProgress = false;
        });
        exporter.export(this.grid, options);
    }
}
IgxGridToolbarExporterComponent.decorators = [
    { type: Component, args: [{
                selector: 'igx-grid-toolbar-exporter',
                template: "<div class=\"igx-grid-toolbar__dropdown\" id=\"btnExport\">\n    <button [title]=\"grid?.resourceStrings.igx_grid_toolbar_exporter_button_tooltip\" [disabled]=\"isExporting\"\n        igxButton=\"outlined\" [displayDensity]=\"grid.displayDensity\" igxRipple #btn (click)=\"toggle(btn, toggleRef)\">\n        <span class=\"igx-grid-toolbar__button-space\">\n            <igx-icon>import_export</igx-icon>\n            <span #ref>\n                <ng-content></ng-content>\n            </span>\n            <span\n                *ngIf=\"!ref.childNodes.length\">{{ grid.exportText || grid?.resourceStrings.igx_grid_toolbar_exporter_button_label }}</span>\n            <igx-icon>arrow_drop_down</igx-icon>\n        </span>\n    </button>\n\n    <ul class=\"igx-grid-toolbar__dd-list\" igxToggle #toggleRef=\"toggle\">\n        <li *ngIf=\"grid.exportExcel || exportExcel\" #btnExportExcel id=\"btnExportExcel\"\n            class=\"igx-grid-toolbar__dd-list-items\" igxRipple (click)=\"export('excel', toggleRef)\">\n            <ng-template #excel>\n                <ng-content select=[excelText],excel-text></ng-content>\n            </ng-template>\n            <excel-text *ngIf=\"!hasExcelAttr\">\n                {{ grid.exportExcelText || grid?.resourceStrings.igx_grid_toolbar_exporter_excel_entry_text}}\n            </excel-text>\n            <ng-container *ngTemplateOutlet=\"excel\"></ng-container>\n        </li>\n\n        <li *ngIf=\"grid.exportCsv || exportCSV\" #btnExportCsv id=\"btnExportCsv\" class=\"igx-grid-toolbar__dd-list-items\"\n            igxRipple (click)=\"export('csv', toggleRef)\">\n            <ng-template #csv>\n                <ng-content select=[csvText],csv-text></ng-content>\n            </ng-template>\n            <csv-text *ngIf=\"!hasCSVAttr\">\n                {{ grid.exportCsvText || grid?.resourceStrings.igx_grid_toolbar_exporter_csv_entry_text }}</csv-text>\n            <ng-container *ngTemplateOutlet=\"csv\"></ng-container>\n        </li>\n    </ul>\n</div>\n"
            },] }
];
IgxGridToolbarExporterComponent.ctorParameters = () => [
    { type: IgxGridToolbarComponent, decorators: [{ type: Host }] },
    { type: IgxExcelExporterService, decorators: [{ type: Optional }] },
    { type: IgxCsvExporterService, decorators: [{ type: Optional }] }
];
IgxGridToolbarExporterComponent.propDecorators = {
    hasExcelAttr: [{ type: ContentChild, args: [IgxExcelTextDirective,] }],
    hasCSVAttr: [{ type: ContentChild, args: [IgxCSVTextDirective,] }],
    exportCSV: [{ type: Input }],
    exportExcel: [{ type: Input }],
    filename: [{ type: Input }],
    exportStarted: [{ type: Output }],
    exportEnded: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC10b29sYmFyLWV4cG9ydGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9ydW5uZXIvd29yay9pZ25pdGV1aS1hbmd1bGFyL2lnbml0ZXVpLWFuZ3VsYXIvcHJvamVjdHMvaWduaXRldWktYW5ndWxhci9zcmMvIiwic291cmNlcyI6WyJsaWIvZ3JpZHMvdG9vbGJhci9ncmlkLXRvb2xiYXItZXhwb3J0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckcsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzNELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN0RSxPQUFPLEVBQ0gsWUFBWSxFQUVaLHFCQUFxQixFQUNyQixxQkFBcUIsRUFDckIsdUJBQXVCLEVBQ3ZCLHVCQUF1QixFQUMxQixNQUFNLDJCQUEyQixDQUFDO0FBZW5DOzs7Ozs7Ozs7O0dBVUc7QUFLSCxNQUFNLE9BQU8sK0JBQWdDLFNBQVEsb0JBQW9CO0lBa0VyRSxZQUNzQixPQUFnQyxFQUM5QixhQUFzQyxFQUN0QyxXQUFrQztRQUV0RCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFKRyxZQUFPLEdBQVAsT0FBTyxDQUF5QjtRQUM5QixrQkFBYSxHQUFiLGFBQWEsQ0FBeUI7UUFDdEMsZ0JBQVcsR0FBWCxXQUFXLENBQXVCO1FBdkMxRDs7V0FFRztRQUVJLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFFeEI7O1dBRUc7UUFFSSxnQkFBVyxHQUFHLElBQUksQ0FBQztRQUUxQjs7V0FFRztRQUVJLGFBQVEsR0FBRyxjQUFjLENBQUM7UUFFakM7O1dBRUc7UUFDSSxnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUUzQjs7O1dBR0c7UUFFSSxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFvQixDQUFDO1FBRTVEOztXQUVHO1FBRUksZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO0lBUTlDLENBQUM7SUF4REQ7O09BRUc7SUFDSCxJQUFXLGNBQWM7UUFDckIsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUM5QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFXLGdCQUFnQjtRQUN2QixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO0lBQ2hDLENBQUM7SUE4Q00sTUFBTSxDQUFDLElBQXFCLEVBQUUsU0FBOEI7UUFDL0QsSUFBSSxPQUEyQixDQUFDO1FBQ2hDLElBQUksUUFBeUIsQ0FBQztRQUU5QixTQUFTLGFBQVQsU0FBUyx1QkFBVCxTQUFTLENBQUUsS0FBSyxHQUFHO1FBRW5CLFFBQVEsSUFBSSxFQUFFO1lBQ1YsS0FBSyxLQUFLO2dCQUNOLE9BQU8sR0FBRyxJQUFJLHFCQUFxQixDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNyRSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDNUIsTUFBTTtZQUNWLEtBQUssT0FBTztnQkFDUixPQUFPLEdBQUcsSUFBSSx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3JELFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDO1NBQ3JDO1FBRUQsTUFBTSxJQUFJLEdBQUcsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQXNCLENBQUM7UUFFdkYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBRWpDLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNiLE9BQU87U0FDVjtRQUVELFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUNoRCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN4QyxDQUFDOzs7WUFoSEosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSwyQkFBMkI7Z0JBQ3JDLHcrREFBcUQ7YUFDeEQ7OztZQXRDUSx1QkFBdUIsdUJBMEd2QixJQUFJO1lBbEdULHVCQUF1Qix1QkFtR2xCLFFBQVE7WUFyR2IscUJBQXFCLHVCQXNHaEIsUUFBUTs7OzJCQS9EWixZQUFZLFNBQUMscUJBQXFCO3lCQU9sQyxZQUFZLFNBQUMsbUJBQW1CO3dCQW9CaEMsS0FBSzswQkFNTCxLQUFLO3VCQU1MLEtBQUs7NEJBWUwsTUFBTTswQkFNTixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBDb250ZW50Q2hpbGQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT3B0aW9uYWwsIEhvc3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGZpcnN0IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQmFzZVRvb2xiYXJEaXJlY3RpdmUgfSBmcm9tICcuL2dyaWQtdG9vbGJhci5iYXNlJztcbmltcG9ydCB7IElneEdyaWRUb29sYmFyQ29tcG9uZW50IH0gZnJvbSAnLi9ncmlkLXRvb2xiYXIuY29tcG9uZW50JztcbmltcG9ydCB7IElneEV4Y2VsVGV4dERpcmVjdGl2ZSwgSWd4Q1NWVGV4dERpcmVjdGl2ZSB9IGZyb20gJy4vY29tbW9uJztcbmltcG9ydCB7XG4gICAgQ3N2RmlsZVR5cGVzLFxuICAgIElneEJhc2VFeHBvcnRlcixcbiAgICBJZ3hDc3ZFeHBvcnRlck9wdGlvbnMsXG4gICAgSWd4Q3N2RXhwb3J0ZXJTZXJ2aWNlLFxuICAgIElneEV4Y2VsRXhwb3J0ZXJPcHRpb25zLFxuICAgIElneEV4Y2VsRXhwb3J0ZXJTZXJ2aWNlXG59IGZyb20gJy4uLy4uL3NlcnZpY2VzL3B1YmxpY19hcGknO1xuaW1wb3J0IHsgSWd4R3JpZEJhc2VEaXJlY3RpdmUgfSBmcm9tICcuLi9ncmlkLWJhc2UuZGlyZWN0aXZlJztcbmltcG9ydCB7IElneFRvZ2dsZURpcmVjdGl2ZSB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvdG9nZ2xlL3RvZ2dsZS5kaXJlY3RpdmUnO1xuXG5cbmV4cG9ydCB0eXBlIElneEV4cG9ydGVyT3B0aW9ucyA9IElneENzdkV4cG9ydGVyT3B0aW9ucyB8IElneEV4Y2VsRXhwb3J0ZXJPcHRpb25zO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgSWd4RXhwb3J0ZXJFdmVudCB7XG4gICAgZXhwb3J0ZXI6IElneEJhc2VFeHBvcnRlcjtcbiAgICBvcHRpb25zOiBJZ3hFeHBvcnRlck9wdGlvbnM7XG4gICAgZ3JpZDogSWd4R3JpZEJhc2VEaXJlY3RpdmU7XG4gICAgY2FuY2VsOiBib29sZWFuO1xufVxuXG4vKipcbiAqIFByb3ZpZGVzIGEgcHJlLWNvbmZpZ3VyZWQgZXhwb3J0ZXIgY29tcG9uZW50IGZvciB0aGUgZ3JpZC5cbiAqXG4gKiBAcmVtYXJrc1xuICogVGhpcyBjb21wb25lbnQgc3RpbGwgbmVlZHMgdGhlIGFjdHVhbCBleHBvcnRlciBzZXJ2aWNlKHMpIHByb3ZpZGVkIGluIHRoZSBESSBjaGFpblxuICogaW4gb3JkZXIgdG8gZXhwb3J0IHNvbWV0aGluZy5cbiAqXG4gKiBAaWd4TW9kdWxlIElneEdyaWRUb29sYmFyTW9kdWxlXG4gKiBAaWd4UGFyZW50IElneEdyaWRUb29sYmFyQ29tcG9uZW50XG4gKlxuICovXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2lneC1ncmlkLXRvb2xiYXItZXhwb3J0ZXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9ncmlkLXRvb2xiYXItZXhwb3J0ZXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIElneEdyaWRUb29sYmFyRXhwb3J0ZXJDb21wb25lbnQgZXh0ZW5kcyBCYXNlVG9vbGJhckRpcmVjdGl2ZSB7XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgQENvbnRlbnRDaGlsZChJZ3hFeGNlbFRleHREaXJlY3RpdmUpXG4gICAgcHVibGljIGhhc0V4Y2VsQXR0cjogSWd4RXhjZWxUZXh0RGlyZWN0aXZlO1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIEBDb250ZW50Q2hpbGQoSWd4Q1NWVGV4dERpcmVjdGl2ZSlcbiAgICBwdWJsaWMgaGFzQ1NWQXR0cjogSWd4Q1NWVGV4dERpcmVjdGl2ZTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgQ1NWIGV4cG9ydGVyIHNlcnZpY2UgaXMgYXZhaWxhYmxlIGluIHRoZSBESSBjaGFpbi5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IGhhc0NzdkV4cG9ydGVyKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLmNzdkV4cG9ydGVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgRXhjZWwgZXhwb3J0ZXIgc2VydmljZSBpcyBhdmFpbGFibGUgaW4gdGhlIERJIGNoYWluLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgaGFzRXhjZWxFeHBvcnRlcigpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5leGNlbEV4cG9ydGVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgZW50cnkgZm9yIENTViBleHBvcnQuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgZXhwb3J0Q1NWID0gdHJ1ZTtcblxuICAgIC8qKlxuICAgICAqIFNob3cgZW50cnkgZm9yIEV4Y2VsIGV4cG9ydC5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBleHBvcnRFeGNlbCA9IHRydWU7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbmFtZSBmb3IgdGhlIGV4cG9ydGVkIGZpbGUuXG4gICAgICovXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgZmlsZW5hbWUgPSAnRXhwb3J0ZWREYXRhJztcblxuICAgIC8qKlxuICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZXJlIGlzIGFuIGV4cG9ydCBpbiBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgaXNFeHBvcnRpbmcgPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIEVtaXR0ZWQgd2hlbiBzdGFydGluZyBhbiBleHBvcnQgb3BlcmF0aW9uLiBSZS1lbWl0dGVkIGFkZGl0aW9uYWxseVxuICAgICAqIGJ5IHRoZSBncmlkIGl0c2VsZi5cbiAgICAgKi9cbiAgICBAT3V0cHV0KClcbiAgICBwdWJsaWMgZXhwb3J0U3RhcnRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8SWd4RXhwb3J0ZXJFdmVudD4oKTtcblxuICAgIC8qKlxuICAgICAqIEVtaXR0ZWQgb24gc3VjY2Vzc2Z1bCBlbmRpbmcgb2YgYW4gZXhwb3J0IG9wZXJhdGlvbi5cbiAgICAgKi9cbiAgICBAT3V0cHV0KClcbiAgICBwdWJsaWMgZXhwb3J0RW5kZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgQEhvc3QoKSBwcm90ZWN0ZWQgdG9vbGJhcjogSWd4R3JpZFRvb2xiYXJDb21wb25lbnQsXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgZXhjZWxFeHBvcnRlcjogSWd4RXhjZWxFeHBvcnRlclNlcnZpY2UsXG4gICAgICAgIEBPcHRpb25hbCgpIHByaXZhdGUgY3N2RXhwb3J0ZXI6IElneENzdkV4cG9ydGVyU2VydmljZSxcbiAgICApIHtcbiAgICAgICAgc3VwZXIodG9vbGJhcik7XG4gICAgfVxuXG4gICAgcHVibGljIGV4cG9ydCh0eXBlOiAnZXhjZWwnIHwgJ2NzdicsIHRvZ2dsZVJlZj86IElneFRvZ2dsZURpcmVjdGl2ZSk6IHZvaWQge1xuICAgICAgICBsZXQgb3B0aW9uczogSWd4RXhwb3J0ZXJPcHRpb25zO1xuICAgICAgICBsZXQgZXhwb3J0ZXI6IElneEJhc2VFeHBvcnRlcjtcblxuICAgICAgICB0b2dnbGVSZWY/LmNsb3NlKCk7XG5cbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdjc3YnOlxuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBuZXcgSWd4Q3N2RXhwb3J0ZXJPcHRpb25zKHRoaXMuZmlsZW5hbWUsIENzdkZpbGVUeXBlcy5DU1YpO1xuICAgICAgICAgICAgICAgIGV4cG9ydGVyID0gdGhpcy5jc3ZFeHBvcnRlcjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2V4Y2VsJzpcbiAgICAgICAgICAgICAgICBvcHRpb25zID0gbmV3IElneEV4Y2VsRXhwb3J0ZXJPcHRpb25zKHRoaXMuZmlsZW5hbWUpO1xuICAgICAgICAgICAgICAgIGV4cG9ydGVyID0gdGhpcy5leGNlbEV4cG9ydGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXJncyA9IHsgZXhwb3J0ZXIsIG9wdGlvbnMsIGdyaWQ6IHRoaXMuZ3JpZCwgY2FuY2VsOiBmYWxzZSB9IGFzIElneEV4cG9ydGVyRXZlbnQ7XG5cbiAgICAgICAgdGhpcy5leHBvcnRTdGFydGVkLmVtaXQoYXJncyk7XG4gICAgICAgIHRoaXMuZ3JpZC5vblRvb2xiYXJFeHBvcnRpbmcuZW1pdChhcmdzKTtcbiAgICAgICAgdGhpcy5pc0V4cG9ydGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMudG9vbGJhci5zaG93UHJvZ3Jlc3MgPSB0cnVlO1xuXG4gICAgICAgIGlmIChhcmdzLmNhbmNlbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZXhwb3J0ZXIub25FeHBvcnRFbmRlZC5waXBlKGZpcnN0KCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmV4cG9ydEVuZGVkLmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMuaXNFeHBvcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudG9vbGJhci5zaG93UHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXhwb3J0ZXIuZXhwb3J0KHRoaXMuZ3JpZCwgb3B0aW9ucyk7XG4gICAgfVxufVxuIl19